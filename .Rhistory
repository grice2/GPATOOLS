library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*rds"), full.names=TRUE)
n = length(file_list)
df <- read_excel(file_list[i], sheet = sheet)
df$survey <- basename(file_list[i])
df_list <- list(df)
j<- 1
for (i in 2:n){
temp <- read_excel(file_list[i], sheet = sheet)
temp$survey <- basename(file_list[i])
if ((prod(colnames(df) == colnames(temp)) == 1)){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
df_list[[j+1]] <- temp
j<-j+1
}
}
View(df)
View(df_list)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*rds"), full.names=TRUE)
n = length(file_list)
df <- read_excel(file_list[i], sheet = sheet)
df$survey <- basename(file_list[i])
df_list <- list(df)
j<- 1
for (i in 2:n){
temp <- read_excel(file_list[i], sheet = sheet)
temp$survey <- basename(file_list[i])
if (prod(colnames(df) == colnames(temp)) == 1){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
for (k in 1:j) {
if (prod(colnames(temp) == colnames(df_list[[k]])) == 1) {
df_list[[k]] <- rbindlist(list(df_list[[k]], temp), use.names = T)
}
else {
df_list[[j+1]] <- temp
j<-j+1}
}
}
}
length(df_list)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
df<- read_all(dir, sheet)
read_all <- function(dir, sheet = "Individuals Coded"){
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*.rds"), full.names=TRUE)
df <- read_excel(file_list[i], sheet = sheet)
df$survey <- basename(file_list[i])
df_list <- list(df)
j<- 1
for (i in 2:length(file_list)){
temp <- read_excel(file_list[i], sheet = sheet)
temp$survey <- basename(file_list[i])
if (prod(colnames(df) == colnames(temp)) == 1){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
for (k in 1:j) {
if (prod(colnames(temp) == colnames(df_list[[k]])) == 1) {
df_list[[k]] <- rbindlist(list(df_list[[k]], temp), use.names = T)
}
else {
df_list[[j+1]] <- temp
j<-j+1}
}
}
}
if (length(df_list)>1) {
return(df_list)
} else {
return(df)
}
}
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
read_all <- function(dir, sheet = "Individuals Coded"){
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*.rds"), full.names=TRUE)
df <- read_excel(file_list[i], sheet = sheet)
df$survey <- basename(file_list[i])
df_list <- list(df)
j<- 1
for (i in 2:length(file_list)){
temp <- read_excel(file_list[i], sheet = sheet)
temp$survey <- basename(file_list[i])
if (prod(colnames(df) == colnames(temp)) == 1){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
for (k in 1:j) {
if (prod(colnames(temp) == colnames(df_list[[k]])) == 1) {
df_list[[k]] <- rbindlist(list(df_list[[k]], temp), use.names = T)
}
else {
df_list[[j+1]] <- temp
j<-j+1}
}
}
}
if (length(df_list)>1) {
return(df_list)
} else {
return(df)
}
}
df<- read_all(dir, sheet)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
read_all <- function(dir, sheet = "Individuals Coded"){
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*.rds"), full.names=TRUE)
df <- read_excel(file_list[1], sheet = sheet)
df$survey <- basename(file_list[1])
df_list <- list(df)
j<- 1
for (i in 2:length(file_list)){
temp <- read_excel(file_list[i], sheet = sheet)
temp$survey <- basename(file_list[i])
if (prod(colnames(df) == colnames(temp)) == 1){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
for (k in 1:j) {
if (prod(colnames(temp) == colnames(df_list[[k]])) == 1) {
df_list[[k]] <- rbindlist(list(df_list[[k]], temp), use.names = T)
}
else {
df_list[[j+1]] <- temp
j<-j+1}
}
}
}
if (length(df_list)>1) {
return(df_list)
} else {
return(df)
}
}
df<- read_all(dir, sheet)
View(df)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
read_all <- function(dir, sheet = "Individuals Coded"){
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*.rds"), full.names=TRUE)
df <- read_excel(file_list[1], sheet = sheet)
df$survey <- basename(file_list[1])
df_list <- list(df)
j<- 1
for (i in 2:length(file_list)){
temp <- read_excel(file_list[i], sheet = sheet)
temp$survey <- basename(file_list[i])
if (prod(colnames(df) == colnames(temp)) == 1){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
for (k in 1:j) {
if (prod(colnames(temp) == colnames(df_list[[k]])) == 1) {
df_list[[k]] <- rbindlist(list(df_list[[k]], temp), use.names = T)
}
else {
df_list[[j+1]] <- temp
j<-j+1}
}
}
}
if (length(df_list)>1) {
return(df_list)
} else {
return(df)
}
}
df<- read_all(dir, sheet)
View(df)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
read_all <- function(dir, sheet = "Individuals Coded"){
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*.rds"), full.names=TRUE)
df <- read_excel(file_list[1], sheet = sheet)
df$survey <- basename(file_list[1])
df_list <- list(df)
j<- 1
for (i in 2:length(file_list)){
temp <- read_excel(file_list[i], sheet = sheet)
temp$survey <- basename(file_list[i])
if (prod(colnames(df) == colnames(temp)) == 1){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
k <- 1
need_to_append <- TRUE
while (k <= j) {
if(prod(colnames(temp) == colnames(df_list[[k]])) == 1){
df_list[[k]] <- rbindlist(list(df_list[[k]], temp), use.names = T)
need_to_append <- FALSE
}
k <- k+1
}
if (k>j & need_to_append) {
df_list[[k]] <- temp
j<-k
}
}
}
if (length(df_list)>1) {
return(df_list)
} else {
return(df)
}
}
df<- read_all(dir, sheet)
View(df)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
df_reactions <- try(readxl::read_excel(df_reactions_dir))
if (class(df_reactions) == "try-error") {
df_reactions <-data.table::fread(df_reactions_dir)
}
read_all <- function(dir, sheet = "Individuals Coded"){
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*.rds"), full.names=TRUE)
df <- try(readxl::read_excel(file_list[1], sheet = sheet))
if (class(df) == "try-error") {
df <-data.table::fread(file_list[1])
}
df$survey <- basename(file_list[1])
df_list <- list(df)
j<- 1
for (i in 2:length(file_list)){
temp <- try(readxl::read_excel(file_list[i], sheet = sheet))
if (class(temp) == "try-error") {
temp <-data.table::fread(file_list[i])
}
temp$survey <- basename(file_list[i])
if (prod(colnames(df) == colnames(temp)) == 1){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
k <- 1
need_to_append <- TRUE
while (k <= j) {
if(prod(colnames(temp) == colnames(df_list[[k]])) == 1){
df_list[[k]] <- rbindlist(list(df_list[[k]], temp), use.names = T)
need_to_append <- FALSE
}
k <- k+1
}
if (k>j & need_to_append) {
df_list[[k]] <- temp
j<-k
}
}
}
if (length(df_list)>1) {
return(df_list)
} else {
return(df)
}
}
df<- read_all(dir, sheet)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
read_all <- function(dir, sheet = "Individuals Coded"){
file_list <- list.files(dir, pattern=c("*.csv|*.xlsx|*.rds"), full.names=TRUE)
df <- try(readxl::read_excel(file_list[1], sheet = sheet))
if (class(df) == "try-error") {
df <-data.table::fread(file_list[1])
}
df$survey <- basename(file_list[1])
df_list <- list(df)
j<- 1
for (i in 2:length(file_list)){
temp <- try(readxl::read_excel(file_list[i], sheet = sheet))
if (class(temp) == "try-error") {
temp <-data.table::fread(file_list[i])
}
temp$survey <- basename(file_list[i])
if (prod(colnames(df) == colnames(temp)) == 1){
df <- rbindlist(list(df, temp), use.names = T)
df_list[[j]] <- df
}
else {
k <- 1
need_to_append <- TRUE
while (k <= j) {
if(prod(colnames(temp) == colnames(df_list[[k]])) == 1){
df_list[[k]] <- rbindlist(list(df_list[[k]], temp), use.names = T)
need_to_append <- FALSE
}
k <- k+1
}
if (k>j & need_to_append) {
df_list[[k]] <- temp
j<-k
}
}
}
if (length(df_list)>1) {
return(df_list)
} else {
return(df)
}
}
df<- read_all(dir, sheet)
View(df)
View(df)
View(df)
setwd("~/GitHub/GPATOOLS")
devtools::document()
devtools::install_github("sieu-tran/GPATOOLS")
devtools::install_github("sieu-tran/GPATOOLS")
?read_all
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Capitol Riot Persuasion Test Round 1"
sheet <- "Individuals Coded"
df<- read_all(dir, sheet)
View(df)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Mexico-Billboard_Images-September-2020"
sheet <- "Individuals Coded"
df<- read_all(dir, sheet)
View(df)
table(df$survey)
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, rpart, rpart.plot, readxl,
zoo, base, survey, pwr, tidyverse, ggalt, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Oscuro-Migration-September-2020"
sheet <- "Individuals Coded"
df<- read_all(dir, sheet)
View(df)
table(df[[1]]$survey)
table(df[[2]]$survey)
table(df[[3]]$survey)
toupper("hello")
cap("hello")
wrap_labels("hellloafsidufbiadsbfviadsbfd abf   edasfdasfdasf a",10)
str_detect("helllo el","el")
str_detect("el", "helllo el")
makeTitle("hello")
re_from <- "\\b([[:lower:]])([[:lower:]]+)"
keys <- gsub(re_from, "\\U\\1\\L\\2" ,c("mot","hai","ba"), perl=TRUE)
keys
re_from <- "\\b([[:lower:]])([[:lower:]]+)"
keys <- gsub(re_from, "\\U\\1\\L\\2" ,c("mot_hai_ba","hai ba","ba-ba"), perl=TRUE)
keys
gsub("_"," ",keys)
gsub("-"," ",keys)
extract_var <- function(data, var = "var", title = "survey", keys= NA) {
re_from <- "\\b([[:lower:]])([[:lower:]]+)"
keys <- gsub(re_from, "\\U\\1\\L\\2" ,keys, perl=TRUE)
keys <- gsub("_", " ", keys)
keys <- gsub("-", " ", keys)
for (i in 1:length(keys)) {
data[[var]] <- NA
data[[var]][str_detect(data[[title]],keys[i])] <- keys[i]
}
}
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, readxl, pwr, tidyverse, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Oscuro-Migration-September-2020"
sheet <- "Individuals Coded"
df <- read_all(dir, sheet)
View(df)
table(df[[3]]$survey)
dat <- extract_var(data = df[[3]], var = "control", keys = c("Control","Treatment"))
extract_var <- function(data, var = "var", title = "survey", keys= NA) {
re_from <- "\\b([[:lower:]])([[:lower:]]+)"
keys <- gsub(re_from, "\\U\\1\\L\\2" ,keys, perl=TRUE)
keys <- gsub("_", " ", keys)
keys <- gsub("-", " ", keys)
for (i in 1:length(keys)) {
data[[var]] <- NA
data[[var]][str_detect(data[[title]],keys[i])] <- keys[i]
}
return(data)
}
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, readxl, pwr, tidyverse, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Oscuro-Migration-September-2020"
sheet <- "Individuals Coded"
df <- read_all(dir, sheet)
table(df[[3]]$survey)
dat <- extract_var(data = df[[3]], var = "control", keys = c("Control","Treatment"))
View(dat)
dat <- extract_var(data = df[[3]], var = "control", title= "survey",keys = c("Control","Treatment"))
View(dat)
extract_var <- function(data, var = "var", title = "survey", keys= NA) {
re_from <- "\\b([[:lower:]])([[:lower:]]+)"
keys <- gsub(re_from, "\\U\\1\\L\\2" ,keys, perl=TRUE)
keys <- gsub("_", " ", keys)
keys <- gsub("-", " ", keys)
data[[var]] <- NA
for (i in 1:length(keys)) {
data[[var]][str_detect(data[[title]],keys[i])] <- keys[i]
}
return(data)
}
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, readxl, pwr, tidyverse, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Oscuro-Migration-September-2020"
sheet <- "Individuals Coded"
df <- read_all(dir, sheet)
table(df[[3]]$survey)
dat <- extract_var(data = df[[3]], var = "control", title= "survey",keys = c("Control","Treatment"))
View(dat)
table(dat$control)
dat <- df%>% extract_var(var = "control", keys = c("Control","Treatment"))
dat <- df[[3]] %>% extract_var(var = "control", keys = c("Control","Treatment"))
View(dat)
dat <- df[[3]] %>% extract_var(var = "control", keys = c("Parents","Non-Parents"))
table(dat$control)
dat <- df[[3]] %>% extract_var(var = "control", keys = c("Non-Parents","Parents"))
table(dat$control)
dat <- df[[3]] %>% extract_var(var = "control", keys = c("Non-Parents","_Parents"))
table(dat$control)
table(dat$control)
dat <- df[[3]] %>% extract_var(var = "control", keys = c("Non-Parents","\_Parents"))
dat <- df[[3]] %>% extract_var(var = "control", keys = c("_Non-Parents","_Parents"))
table(dat$control)
View(dat)
dat <- df[[3]] %>% extract_var(var = "control", keys = c("Non-Parents"))
View(dat)
extract_var <- function(data, var = "var", title = "survey", keys= NA) {
data[[var]] <- NA
for (i in 1:length(keys)) {
data[[var]][str_detect(data[[title]],keys[i])] <- keys[i]
}
re_from <- "\\b([[:lower:]])([[:lower:]]+)"
data[[var]] <- gsub(re_from, "\\U\\1\\L\\2" ,data[[var]], perl=TRUE)
data[[var]] <- gsub("_", " ", data[[var]])
data[[var]] <- gsub("-", " ", data[[var]])
return(data)
}
dat <- df[[3]] %>% extract_var(var = "control", keys = c("Non-Parents"))
View(dat)
extract_var <- function(data, var = "var", title = "survey", keys= NA,remove.dash = TRUE, remove.underscore = TRUE, capitalize = TRUE) {
data[[var]] <- NA
for (i in 1:length(keys)) {
data[[var]][str_detect(data[[title]],keys[i])] <- keys[i]
}
re_from <- "\\b([[:lower:]])([[:lower:]]+)"
if (capitalize) {data[[var]] <- gsub(re_from, "\\U\\1\\L\\2" ,data[[var]], perl=TRUE)}
if (remove.underscore) {data[[var]] <- gsub("_", " ", data[[var]])}
if (remove.dash) {data[[var]] <- gsub("-", " ", data[[var]])}
return(data)
}
### Load Packages and Functions #####
library(pacman)
p_load(GPATOOLS, data.table, ggplot2, stringr, reshape2, gbm, readxl, pwr, tidyverse, openxlsx)
dir <- "C:/Users/sieu.tran/Desktop/DOS Work/Persuasion Test/Oscuro-Migration-September-2020"
sheet <- "Individuals Coded"
df <- read_all(dir, sheet)
table(df[[3]]$survey)
dat <- df[[3]] %>% extract_var(var = "control", keys = c("Parents", "Non-Parents"))
table(dat$control)
dat <- df[[3]] %>% extract_var(var = "control", remove.dash = FALSE, keys = c("Parents", "Non-Parents"))
table(dat$control)
